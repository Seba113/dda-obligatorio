<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Propietarios</title>
    <link rel="stylesheet" href="panel-propietarios.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 id="titulo">游늵 Tablero de control del propietario</h1>
            <button class="btn-salir" onclick="salir()">Salir</button>
        </div>
        
        <!-- Resumen del propietario -->
        <div class="section">
            <div class="section-title">Resumen del propietario</div>
            <div class="resumen">
                <div class="resumen-item">
                    <span class="resumen-label">Nombre Completo</span>
                    <span class="resumen-value" id="nombrePropietario"></span>
                </div>
                <div class="resumen-item">
                    <span class="resumen-label">Estado</span>
                    <span class="resumen-value estado-activo" id="estadoPropietario"></span>
                </div>
                <div class="resumen-item">
                    <span class="resumen-label">Saldo Actual</span>
                    <span class="resumen-value saldo-amount" id="saldoPropietario"></span>
                </div>
            </div>
        </div>
        
        <!-- Grid: Bonificaciones y Veh칤culos -->
        <div class="grid-2col">
            <!-- Bonificaciones asignadas -->
            <div class="section">
                <div class="section-title">Bonificaciones asignadas</div>
                <table>
                    <thead>
                        <tr>
                            <th>Bonificaci칩n</th>
                            <th>Puesto</th>
                            <th>Fecha asignada</th>
                        </tr>
                    </thead>
                    <tbody id="tablaBonificaciones"></tbody>
                </table>
            </div>
            
            <!-- Veh칤culos registrados -->
            <div class="section">
                <div class="section-title">Veh칤culos registrados</div>
                <table>
                    <thead>
                        <tr>
                            <th>Matr칤cula</th>
                            <th>Modelo</th>
                            <th>Color</th>
                            <th>Tr치nsitos</th>
                            <th>Monto total</th>
                        </tr>
                    </thead>
                    <tbody id="tablaVehiculos"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Tr치nsitos realizados -->
        <div class="section">
            <div class="section-title">Tr치nsitos realizados</div>
            <table>
                <thead>
                    <tr>
                        <th>Puesto</th>
                        <th>Matr칤cula</th>
                        <th>Tarifa</th>
                        <th>Monto tarifa</th>
                        <th>Bonificaci칩n</th>
                        <th>Monto bonificaci칩n</th>
                        <th>Monto pagado</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="tablaTransitos"></tbody>
            </table>
        </div>
        
        <!-- Notificaciones del sistema -->
        <div class="section">
            <div class="notificaciones-header">
                <div class="section-title" style="margin: 0; padding: 0; border: none;">Notificaciones del sistema</div>
                <button class="btn-borrar" onclick="borrarNotificaciones()">Borrar notificaciones</button>
            </div>
            <div id="listaNotificaciones"></div>
        </div>
    </div>
    
</body>
<script src="vistaWeb.js"></script>
<script src="utilesVista.js"></script>
<script>
    // Iniciar la vista autom치ticamente (vistaWeb.js usa urlIniciarVista)
    var urlIniciarVista = "/propietario/tablero";
    var parametrosInicioVista = "";

    const URL_SALIR = "acceso/logoutPeaje"; // controlador: /acceso/logoutPeaje

    // Handlers que procesan las respuestas del backend: mostrar_<id>
    function mostrar_resumen(param) {
        if (!param) return;
        document.getElementById('nombrePropietario').textContent = param.nombreCompleto || '';
        document.getElementById('estadoPropietario').textContent = param.estado || '';
        document.getElementById('saldoPropietario').textContent = (param.saldoActual != null) ? ('$ ' + Number(param.saldoActual).toFixed(2)) : '';
    }

    function mostrar_bonificaciones(lista) {
        const tbody = document.getElementById('tablaBonificaciones');
        tbody.innerHTML = '';
        if (!Array.isArray(lista) || lista.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" class="empty-message">No hay bonificaciones asignadas.</td></tr>';
            return;
        }
        lista.forEach(b => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${b.nombreBonificacion || ''}</td><td>${b.nombrePuesto || ''}</td><td>${b.fechaAsignada ? new Date(b.fechaAsignada).toLocaleDateString() : ''}</td>`;
            tbody.appendChild(tr);
        });
    }

    function mostrar_vehiculos(lista) {
        const tbody = document.getElementById('tablaVehiculos');
        tbody.innerHTML = '';
        if (!Array.isArray(lista) || lista.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="empty-message">No hay veh칤culos registrados.</td></tr>';
            return;
        }
        lista.forEach(v => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${v.matricula || ''}</td><td>${v.modelo || ''}</td><td>${v.color || ''}</td><td>${v.cantidadTransitos || 0}</td><td class="monto-positivo">$ ${Number(v.montoTotal || 0).toFixed(2)}</td>`;
            tbody.appendChild(tr);
        });
    }

    function mostrar_transitos(lista) {
        const tbody = document.getElementById('tablaTransitos');
        tbody.innerHTML = '';
        if (!Array.isArray(lista) || lista.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" class="empty-message">No hay tr치nsitos para mostrar.</td></tr>';
            return;
        }
        lista.forEach(t => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${t.puesto || ''}</td>
                <td>${t.matricula || ''}</td>
                <td>${t.tarifa || ''}</td>
                <td>$ ${Number(t.montoTarifa || 0).toFixed(2)}</td>
                <td>${t.bonificacion || ''}</td>
                <td class="monto-negativo">${t.montoBonificacion ? ('-$ ' + Math.abs(Number(t.montoBonificacion)).toFixed(2)) : ''}</td>
                <td class="monto-positivo">$ ${Number(t.montoPagado || 0).toFixed(2)}</td>
                <td>${t.fecha ? new Date(t.fecha).toLocaleDateString() : ''}</td>
                <td>${t.hora || ''}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function mostrar_notificaciones(lista) {
        const cont = document.getElementById('listaNotificaciones');
        cont.innerHTML = '';
        if (!Array.isArray(lista) || lista.length === 0) {
            cont.innerHTML = '<div class="empty-message">No hay notificaciones.</div>';
            return;
        }
        lista.forEach(n => {
            const div = document.createElement('div');
            div.className = 'notificacion-item';
            div.innerHTML = `<div class="notificacion-fecha">${n.fechaHora ? new Date(n.fechaHora).toLocaleString() : ''}</div><div class="notificacion-mensaje">${n.mensaje || ''}</div>`;
            cont.appendChild(div);
        });
    }

    function mostrar_exito(msg) {
        console.log('칄xito:', msg);
    }

    function mostrar_error(msg) {
        mostrarMensaje(msg || 'Se produjo un error');
    }

    function mostrar_paginaLogin(url) {
        window.location.href = url || '/login-propietarios';
    }

    function salir() {
        submit(URL_SALIR, '');
    }

    function borrarNotificaciones() {
        submit('/propietario/borrarNotificaciones', '');
    }

    // Export minimal helpers for console/testing
    window.borrarNotificaciones = borrarNotificaciones;
    window.salir = salir;
</script>
</html>