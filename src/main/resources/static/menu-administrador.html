<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administracion</title>
    <link rel="stylesheet" href="administracion.css">
    <!-- Orden recomendado: utilidades -> sse -> vistaWeb (submit depende de primerSubmitFinalizado) -->
    <script src="utilesVista.js"></script>
    <script src='sse.js'></script>
    <script src='vistaWeb.js'></script>
</head>
<body>
    <div class="sidebar">
        <label id="nombreCompleto"> </label>
        <button onclick="cargarContenido('emular-transito.html')">Emular transito</button>
        <button onclick="cargarContenido('asignar-bonificaciones.html')">Asignar Bonificaciones</button>
        <button onclick="cargarContenido('cambiar-estado.html')">Cambiar Estado</button>
        <button onclick="logout()">Salir</button>
    </div>
    <div class="content">
        <iframe id="contenidoFrame" src="emular-transito.html" frameborder="0" style="width:100%;height:80vh;"></iframe>
    </div>
    <script>

        urlIniciarVista="/menu-administracion/vistaConectada";
        urlCierreVista="/acceso/logoutAdministrador";
        urlRegistroSSE = "/menu-administracion/registrarSSE";

        
        const spnNombreCompleto = document.getElementById("nombreCompleto");

        function cargarContenido(pagina) 
            { contenidoFrame.src = pagina; }
        
        function mostrar_nombreCompleto(nombreCompleto){
          spnNombreCompleto.innerHTML = "ADMINISTRADOR: " + nombreCompleto.toUpperCase();
        }
        function logout(){
            submit("/acceso/logoutAdministrador");
          
        }
        function procesarErrorSubmit(status,text){
            if(status==400){ //El usuario no ha iniciado sesion
                window.location.href="login-admin.html";
            }
        }
        function mostrar_paginaLogin(url){
            window.location.href=url;
        }
        //Cuando llega un mensaje SSE lo delego al iFrame actual como una respuesta del controlador
        function procesarMensajeSSE(mensaje) {
  
            var iframe = document.getElementById('contenidoFrame');
            var iframeWindow = iframe.contentWindow;
            iframeWindow.procesarResultadosSubmit(mensaje); //asumo que el iFrame tiene vistaWeb.js incluida
        }
        
        //Se ejecuta cuando se cierra la conexion desde el servidor
        //Si no se define esta funcion, por defecto se "borra" la pagina 
        function conexionSSECerrada(event){
              cerrar();
        }
        async function cerrar(){
            let respuesta = await mostrarConfirmacion("Se ha cerrado la aplicacion en esta ventana", "Intenar volver a abrirla", "Cerrar");
            if (respuesta) {
                location.reload();
            } else {
                document.body.innerHTML = '';
            }
        }

        
    </script>
</body>
</html>
